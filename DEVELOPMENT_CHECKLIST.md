### Шаг 1. Инициализация проекта

- [+] Установить Node.js на Linux.
- [+] Создать проект (`npm init`, добавить Electron или использовать
  шаблон/Forge).
- [+] Настроить `src/main/index.js` (главное окно, включить `preload`).

### Шаг 2. Подключение SQLite

- [+] Добавить зависимость `better-sqlite3` (или альтернативу).
- [+] При старте приложения:
  - [+] Определить путь `app.getPath('userData')`;
  - [+] Открыть/создать файл БД;
  - [+] Выполнить SQL‑скрипты создания таблиц (`cases`, `subjects`, `artifacts`,
    `legal_marks`).

### Шаг 3. IPC и API

- [+] В `src/preload/index.js` реализовать `window.api` с методами:
  - `getCases`, `createCase`, `getCaseArtifacts`, `saveArtifact`,
    `updateLegalMarks` и т.п.
- [+] В `src/main/index.js` реализовать `ipcMain.handle(...)`:
  - каждый метод обращается к SQLite и/или файловой системе.

### Шаг 4. Встроенный браузер

- [+] Реализовать `<webview>`/BrowserView в UI.
- [+] Добавить кнопки быстрых переходов:
  - VK, Одноклассники, Telegram Web, WhatsApp Web, Max, «Новости».
- [+] Связать выбранный `case_id` с текущим состоянием UI.

### Шаг 5. Сохранение артефактов

- [ ] В UI: кнопка «Сохранить артефакт».
- [ ] В рендерере: вызвать `window.api.captureArtifact(caseId, subjectId?)`.
- [ ] В main‑процессе:
  - [ ] получить URL и заголовок через `webContents`/`webview`;
  - [ ] сделать скрин с `capturePage`;
  - [ ] сохранить PNG в каталог `userData/screenshots/...`;
  - [ ] получить HTML/текст (по возможности) и сохранить файлы;
  - [ ] записать строку в `artifacts`.

### Шаг 6. UI для дел и артефактов

- [ ] Экран списка дел:
  - [ ] таблица дел;
  - [ ] форма создания дела.
- [ ] Экран дела:
  - [ ] отображение информации по делу/subject;
  - [ ] список артефактов с сортировкой/фильтрацией.

### Шаг 7. Метки и правовые признаки

- [x] В карточке артефакта добавить интерфейс:
  - [x] выбор `label` (типа нарушения);
  - [x] поле `article_text`;
  - [x] поле `comment`.
- [x] Связать с таблицей `legal_marks`.

### Шаг 8. Экспорт отчёта

- [ ] Сформировать HTML‑страницу отчёта по делу.
- [ ] В скрытом окне вызвать `printToPDF` и сохранить файл PDF.
- [ ] Добавить кнопку «Экспорт отчёта» в UI дела.

### Шаг 9. Сборка под Windows

- [ ] Настроить `electron-builder`:
  - [ ] указать целевые платформы;
  - [ ] настроить название/иконку.
- [ ] Собрать `.exe` под Windows.
- [ ] Протестировать на реальной машине.

### Шаг 10. Авторизация

# Роль

Вы — эксперт по разработке систем безопасности и контроля доступа с глубокими
знаниями в области аутентификации, авторизации и управления ролями (RBAC). Вы
специализируетесь на проектировании надежных, масштабируемых и безопасных
решений для защиты приложений на базе Electron и JavaScript.

# Задача

Разработать и внедрить систему аутентификации на основе логина и пароля, а также
систему авторизации на основе ролей (Role-Based Access Control) для
Electron-приложения с использованием JavaScript и SQLite.

# Контекст

Система аутентификации и авторизации является критически важным компонентом
безопасности приложения. Аутентификация подтверждает личность пользователя через
проверку логина и пароля, а авторизация на основе ролей определяет, какие
действия и ресурсы доступны пользователю в зависимости от его роли. Эта
двухуровневая система защиты обеспечивает контролируемый доступ к
функциональности приложения и защищает конфиденциальные данные. В контексте
Electron-приложения необходимо учитывать специфику десктопной разработки и
локального хранения данных в SQLite.

# Инструкции

Помощник должен предоставить комплексное решение для Electron + JavaScript +
SQLite, включающее следующие компоненты:

**1. Система аутентификации:**

- Реализовать механизм регистрации пользователей с валидацией логина и пароля на
  JavaScript
- Обеспечить безопасное хеширование паролей с использованием bcrypt для Node.js
- Создать процесс входа в систему с проверкой учетных данных через SQLite
- Реализовать генерацию и управление токенами доступа (JWT) с использованием
  библиотеки jsonwebtoken
- Добавить механизм выхода из системы и инвалидации токенов
- Использовать IPC (Inter-Process Communication) для безопасной передачи данных
  между main и renderer процессами Electron

**2. Система авторизации на основе ролей:**

- Определить структуру для трех ролей: **Суперадмин** (полный доступ ко всем
  функциям системы, управление пользователями и ролями), **Администратор
  отдела** (управление пользователями своего отдела, доступ к отчетам отдела),
  **Сотрудник** (базовый доступ к функционалу в рамках своих обязанностей)
- Создать таблицу ролей и разрешений в SQLite с предопределенными правами для
  каждой роли
- Реализовать middleware-функции для проверки прав доступа перед выполнением
  операций
- Обеспечить гранулярный контроль доступа к функциям приложения на уровне UI и
  backend
- Предусмотреть иерархию ролей: Суперадмин > Администратор отдела > Сотрудник

**3. Структура базы данных SQLite:**

- Создать схему таблиц: `users` (id, login, password_hash, role_id,
  department_id, created_at, last_login)
- Таблица `roles` (id, role_name, permissions_json)
- Таблица `sessions` (id, user_id, token, expires_at, created_at) для управления
  активными сессиями
- Предоставить SQL-скрипты для инициализации базы данных
- Реализовать работу с SQLite через библиотеку better-sqlite3 или sqlite3

**4. Обработка граничных случаев:**

- Защита от brute-force атак: ограничение попыток входа (максимум 5 попыток за
  15 минут) с временной блокировкой аккаунта
- Обработка истекших токенов и сессий с автоматическим перенаправлением на
  страницу входа
- Действия при попытке доступа без авторизации: показ сообщения об ошибке и
  блокировка функционала
- Обработка попыток повышения привилегий: логирование и немедленное прекращение
  операции
- Логирование всех попыток входа, изменений ролей и подозрительной активности в
  отдельную таблицу `audit_log`
- Обработка случаев, когда база данных SQLite недоступна или повреждена

**5. Специфика Electron-приложения:**

- Хранить токены в безопасном хранилище (electron-store с шифрованием или
  keytar)
- Использовать contextBridge для безопасного взаимодействия между процессами
- Отключить Node.js integration в renderer процессе для повышения безопасности
- Реализовать Content Security Policy (CSP)
- Обеспечить шифрование базы данных SQLite с использованием SQLCipher
  (опционально)

Помощник должен предоставить production-ready код на JavaScript с использованием
современного синтаксиса (ES6+), включая:

- Полный пример main.js и renderer.js для Electron
- Модуль для работы с аутентификацией (auth.js)
- Модуль для работы с авторизацией и проверкой ролей (rbac.js)
- Модуль для работы с SQLite (database.js)
- Примеры UI-компонентов для форм входа и регистрации
- SQL-скрипты инициализации базы данных
- Конфигурационные файлы с комментариями

Решение должно включать подробные комментарии к коду, следовать принципам
безопасной разработки и учитывать специфику десктопных приложений. Это
критически важно для защиты данных пользователей и целостности системы.
