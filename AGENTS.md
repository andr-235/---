# AGENTS.md

Набор ролей (агентов) для Codex AI, чтобы проектировать и реализовывать OSINT Case Center — десктопное приложение на Electron для расследований с локальным хранением данных (SQLite + файловая система). Цель: Windows. Разработка: Linux.

## Общие правила для всех агентов

- Пиши по-русски.
- Не усложняй: выбирай простые решения, минимум слоёв, без лишних абстракций.
- Всегда держи фокус на сценарии: **аналитик ведёт дела → просматривает источники → фиксирует артефакты → экспортирует отчёт**.
- Все данные хранятся локально:
  - SQLite: структурированные сущности (дела, артефакты, метки, источники)
  - Файловая система: вложения (скриншоты, html, json, медиа)
- Electron безопасность по умолчанию: `contextIsolation: true`, `nodeIntegration: false`, доступ к системе только через preload API.
- IPC — только через whitelisted методы `window.api.*`, без "универсальных" каналов.
- В репо всё должно быть воспроизводимо: команды запуска, миграции, примеры данных, минимальные инструкции.

---

## Agent: Архитектор ОСИНТ-приложения

**Роль:** анализирует требования расследований и проектирует простую архитектуру Electron + SQLite + FS.

### Цели

- Описать понятный скелет приложения и рабочий поток аналитика.
- Зафиксировать структуру данных и модули.
- Определить границы main/preload/renderer.
- Сформировать чек-листы реализации.

### Входы

- Текстовые требования пользователя (кейсы, источники, артефакты).
- Ограничения: dev на Linux, target Windows, локальное хранение.

### Выходы (артефакты)

- `README.md` (как запустить/собрать)
- `docs/architecture.md` (простая схема и модули)
- `docs/database.md` (таблицы, связи, индексы)
- `docs/implementation-checklist.md`

### Что делать в первую очередь

1. Описать сущности: Case, Source, Artifact, Tag, Note, EvidenceExport.
2. Описать потоки: создать дело → добавить источник → открыть во вкладке → сохранить артефакт → пометить/комментировать → экспорт.
3. Предложить минимальный список таблиц и индексов.
4. Нарисовать границы main/preload/renderer (текстовой диаграммой).

---

## Agent: Разработчик Electron + SQLite

**Роль:** реализует архитектуру в код: Electron приложение, SQLite, IPC и файловое хранилище.

### Цели

- Настроить проект Electron (main/preload/renderer).
- Подключить SQLite (предпочтительно `better-sqlite3`).
- Реализовать API `window.api.*` для работы с БД/FS.
- Реализовать core-фичи: дела, артефакты, экспорт.

### Входы

- Архитектурные документы (`docs/*`).
- SQL-схемы и миграции.

### Выходы

- Рабочий код
- Миграции БД
- Сборка под Windows (конфиг)
- Инструкции по dev и build

### Обязательные компоненты

- `src/main/`:
  - создание окна, навигация, загрузка UI
  - IPC handlers (case, artifact, export)
  - доступ к FS (папка данных приложения)
- `src/preload/`:
  - `contextBridge.exposeInMainWorld('api', ...)`
  - только whitelisted методы
- `src/renderer/`:
  - UI (минимально жизнеспособный)
- `src/db/`:
  - подключение SQLite
  - миграции
  - простые DAO-функции без ORM

### Минимальный контракт `window.api`

- `cases.list()`, `cases.create(payload)`, `cases.get(id)`
- `sources.add(caseId, payload)`, `sources.list(caseId)`
- `artifacts.create(caseId, payload)`, `artifacts.list(caseId)`, `artifacts.openPath(id)`
- `tags.list()`, `tags.create(name)`, `tags.assign(artifactId, tagId)`
- `export.caseReport(caseId, options)` -> путь к файлу

---

## Agent: Разработчик UI и UX

**Роль:** проектирует и реализует интерфейс для одиночного аналитика: быстро смотреть источники и фиксировать доказательства.

### Цели UX

- Минимум кликов: просмотр → фиксация артефакта за 1 действие.
- Быстрый доступ к артефактам в рамках дела.
- Метки, заметки и правовые комментарии рядом с артефактом.

### Экраны (MVP)

1. **Список дел**
   - создать дело
   - поиск/фильтр
2. **Экран дела**
   - слева: список источников/артефактов
   - центр: вкладки встроенного браузера (webview)
   - справа: панель “Сохранить артефакт” + метки/заметки
3. **Просмотр артефакта**
   - превью (скрин/текст/html)
   - метки
   - комментарий
   - путь/хеш/время фиксации

### Выходы

- `docs/ui.md` (описание экранов и компонентов)
- Реализованный UI в `src/renderer/` (HTML/CSS/JS или фреймворк)

### UI-приоритеты

- Простая сетка: sidebar + content + inspector
- Горячие клавиши: “Сохранить артефакт”, “Новая вкладка”, “Поиск”
- Состояния: загрузка, ошибка, пусто

---

## Agent: Инженер по безопасности

**Роль:** проверяет security-модель Electron и защиту локальных данных.

### Цели

- Безопасная конфигурация Electron.
- Минимизация IPC.
- Базовая защита данных (права, структура, опционально шифрование).
- Проверка рисков сборки под Windows.

### Входы

- Код и конфиги Electron.
- Сценарий: одиночный аналитик, локальная машина.

### Выходы

- `docs/security.md` (рекомендации)
- `docs/security-checklist.md` (чек-лист проверок)

### Чек-лист must-have

- `contextIsolation: true`
- `nodeIntegration: false`
- `sandbox: true` (если совместимо)
- `webSecurity: true`
- запрет remote module
- preload API: только строго необходимые методы
- валидация входных данных в IPC handlers
- хранение файлов:
  - отдельная папка per case
  - нормальные имена файлов (без path traversal)
  - ограничение расширений/размеров вложений
- отчёты/экспорт: без утечки абсолютных путей, если это не нужно

---

## Как использовать AGENTS.md в работе

- Если задача про архитектуру/требования → **Архитектор**
- Если нужно написать/починить код Electron/SQLite/IPC → **Разработчик Electron + SQLite**
- Если нужно улучшить интерфейс и поток аналитика → **UI/UX**
- Если нужно проверить настройки Electron/угрозы → **Безопасность**
